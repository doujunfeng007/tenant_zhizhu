<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.minigod.zero.bpmn.module.account.mapper.AccountCaVerityInfoMapper">
    <!-- 通用查询映射结果 -->
    <resultMap id="account_ca_verity_infoResultMap"
               type="com.minigod.zero.bpmn.module.account.entity.AccountCaVerityInfoEntity"
               extends="com.minigod.zero.bpmn.module.account.mapper.BaseEntityMapper.TenantBaseResultMap">
        <result column="id" property="id"/>
        <result column="application_id" property="applicationId"/>
        <result column="user_id" property="userId"/>
        <result column="ca_cert_dn" property="caCertDn"/>
        <result column="ca_cert_sn" property="caCertSn"/>
        <result column="cert_time" property="certTime"/>
        <result column="file_id" property="fileId"/>
        <result column="file_hash" property="fileHash"/>
    </resultMap>
    <resultMap id="account_ca_verity_infoResultMapVo" type="com.minigod.zero.bpmn.module.account.vo.AccountCaVerityInfoVO"
               extends="account_ca_verity_infoResultMap">
        <result column="client_name" property="clientName"/>
        <result column="phone_number" property="phoneNumber"/>
        <result column="id_no" property="idNo"/>
    </resultMap>
    <select id="queryByApplicationId" resultMap="account_ca_verity_infoResultMapVo">
        select *
        from open_account_ca_verity_info
        where application_id = #{applicationId}
        order by create_time desc
        limit 1
    </select>
    <select id="queryPageList" resultMap="account_ca_verity_infoResultMapVo">
        select c.*,i.client_name,i.client_name_spell,i.phone_number,i.id_no from
        open_account_ca_verity_info
        c
        left join
        customer_account_open_info
        i on c.application_id = i.application_id
        <where>
            <if test="bo.clientName!=null and bo.clientName!=''">
                and (
                i.client_name like concat('%',concat(#{bo.clientName},'%'))
                or i.client_name_spell like concat('%',concat(#{bo.clientName},'%'))
                )
            </if>
            <if test="bo.phoneNumber!=null and bo.phoneNumber!=''">
                and i.phone_number like concat('%',concat(#{bo.phoneNumber},'%'))
            </if>
            <if test="bo.idNo!=null and bo.idNo!=''">
                and i.id_no like concat('%',concat(#{bo.idNo},'%'))
            </if>
            <if test="bo.beginDate!=null and bo.beginDate!=''">
                and c.cert_time between #{bo.beginDate} and #{bo.endDate}
            </if>
        </where>
        order by c.create_time desc
    </select>
</mapper>
