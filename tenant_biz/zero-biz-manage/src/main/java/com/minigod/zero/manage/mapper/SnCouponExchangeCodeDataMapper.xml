<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.minigod.zero.manage.mapper.SnCouponExchangeCodeDataMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.minigod.zero.manage.entity.SnCouponExchangeCodeDataEntity">
        <id column="id" property="id"/>
        <result column="channel_id" property="channelId"/>
        <result column="manage_id" property="manageId"/>
        <result column="exchange_person_number" property="exchangePersonNumber"/>
        <result column="use_person_number" property="usePersonNumber"/>
        <result column="card_type" property="cardType"/>
        <result column="card_name" property="cardName"/>
        <result column="first_open_account_number" property="firstOpenAccountNumber"/>
        <result column="first_deposit_fund_number" property="firstDepositFundNumber"/>
        <result column="first_deposit_fund_amount" property="firstDepositFundAmount"/>
        <result column="first_transfer_number" property="firstTransferNumber"/>
        <result column="first_transfer_amount" property="firstTransferAmount"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
        <result column="create_user" property="createUser"/>
        <result column="update_user" property="updateUser"/>
        <result column="is_deleted" property="isDeleted"/>
        <result column="tenant_id" property="tenantId"/>
        <result column="create_dept" property="createDept"/>
        <result column="status" property="status"/>
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, channel_id, manage_id, exchange_person_number, use_person_number,
        card_type, card_name, first_open_account_number, first_deposit_fund_number,
        first_deposit_fund_amount, first_transfer_number, first_transfer_amount,
        create_time, update_time, create_user, update_user, is_deleted,
        tenant_id, create_dept, status
    </sql>

    <!-- 分页查询 -->
    <select id="queryPage" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM sn_coupon_exchange_code_data
        WHERE is_deleted = 0
        <if test="channelId != null and channelId != ''">
            AND channel_id = #{channelId}
        </if>
        <if test="cardName != null and cardName != ''">
            AND card_name LIKE CONCAT('%', #{cardName}, '%')
        </if>
        <if test="cardType != null">
            AND card_type = #{cardType}
        </if>
        ORDER BY create_time DESC
    </select>

    <!-- 查询渠道数据统计 -->
    <select id="queryByChannel" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM sn_coupon_exchange_code_data
        WHERE is_deleted = 0
        AND channel_id = #{channelId}
        ORDER BY create_time DESC
    </select>

    <!-- 查询优惠券数据统计 -->
    <select id="getByManageId" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM sn_coupon_exchange_code_data
        WHERE is_deleted = 0
        AND manage_id = #{manageId}
        LIMIT 1
    </select>

    <!-- 更新数据统计 -->
    <update id="updateStatistics" parameterType="com.minigod.zero.manage.entity.SnCouponExchangeCodeDataEntity">
        UPDATE sn_coupon_exchange_code_data
        <set>
            <if test="exchangePersonNumber != null">
                exchange_person_number = #{exchangePersonNumber},
            </if>
            <if test="usePersonNumber != null">
                use_person_number = #{usePersonNumber},
            </if>
            <if test="firstOpenAccountNumber != null">
                first_open_account_number = #{firstOpenAccountNumber},
            </if>
            <if test="firstDepositFundNumber != null">
                first_deposit_fund_number = #{firstDepositFundNumber},
            </if>
            <if test="firstDepositFundAmount != null">
                first_deposit_fund_amount = #{firstDepositFundAmount},
            </if>
            <if test="firstTransferNumber != null">
                first_transfer_number = #{firstTransferNumber},
            </if>
            <if test="firstTransferAmount != null">
                first_transfer_amount = #{firstTransferAmount},
            </if>
            update_time = NOW()
        </set>
        WHERE id = #{id}
        AND is_deleted = 0
    </update>

</mapper>
