<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.minigod.zero.data.mapper.TaTHoldingHistoryMapper">

    <resultMap id="BaseResultMap" type="com.minigod.zero.data.entity.TaTHoldingHistoryEntity">
            <id property="id" column="id" jdbcType="INTEGER"/>
            <result property="subaccountid" column="subAccountId" jdbcType="VARCHAR"/>
            <result property="fundcode" column="fundCode" jdbcType="VARCHAR"/>
            <result property="holdingtype" column="holdingType" jdbcType="INTEGER"/>
            <result property="totalquantity" column="totalQuantity" jdbcType="DECIMAL"/>
            <result property="availablequantity" column="availableQuantity" jdbcType="DECIMAL"/>
            <result property="frozenquantity" column="frozenQuantity" jdbcType="DECIMAL"/>
            <result property="transitedquantity" column="transitedQuantity" jdbcType="DECIMAL"/>
            <result property="withdrawquantity" column="withdrawQuantity" jdbcType="DECIMAL"/>
            <result property="averagecost" column="averageCost" jdbcType="DECIMAL"/>
            <result property="dilutedcost" column="dilutedCost" jdbcType="DECIMAL"/>
            <result property="currency" column="currency" jdbcType="VARCHAR"/>
            <result property="accumulatedbuyamount" column="accumulatedBuyAmount" jdbcType="DECIMAL"/>
            <result property="accumulatedcashdividends" column="accumulatedCashDividends" jdbcType="DECIMAL"/>
            <result property="realizedgainloss" column="realizedGainLoss" jdbcType="DECIMAL"/>
            <result property="capitalgainloss" column="capitalGainLoss" jdbcType="DECIMAL"/>
            <result property="totalgainloss" column="totalGainLoss" jdbcType="DECIMAL"/>
            <result property="totalfee" column="totalFee" jdbcType="DECIMAL"/>
            <result property="expectedrate" column="expectedRate" jdbcType="DECIMAL"/>
            <result property="flowid" column="flowId" jdbcType="INTEGER"/>
            <result property="transactiontime" column="transactionTime" jdbcType="TIMESTAMP"/>
            <result property="createtime" column="createTime" jdbcType="TIMESTAMP"/>
            <result property="updatetime" column="updateTime" jdbcType="TIMESTAMP"/>
    </resultMap>

    <sql id="Base_Column_List">
        id,subAccountId,fundCode,
        holdingType,totalQuantity,availableQuantity,
        frozenQuantity,transitedQuantity,withdrawQuantity,
        averageCost,dilutedCost,currency,
        accumulatedBuyAmount,accumulatedCashDividends,realizedGainLoss,
        capitalGainLoss,totalGainLoss,totalFee,
        expectedRate,flowId,transactionTime,
        createTime,updateTime
    </sql>
    <select id="getRealizedGainLoss" resultType="com.minigod.zero.data.entity.TaTHoldingHistoryEntity">
        select a.*
            from t_holding_history a
         left join t_da_client b on b.subAccountId = a.subAccountId and b.daAccountId = 'DF10000001'
        where  a.fundCode = #{productId}
          and b.daClientId  = #{custStatementDTO.subAccountId}
          <if test="custStatementDTO.statementType == 1">
              and a.transactionTime <![CDATA[ <= ]]>  DATE_SUB(#{custStatementDTO.endDate}, INTERVAL 1 DAY)
          </if>
          <if test="custStatementDTO.statementType == 2">
              and a.transactionTime <![CDATA[ <= ]]>  #{custStatementDTO.endDate}
          </if>
        order by createTime desc limit 1
    </select>
    <select id="getHldRealizedGainLoss" resultType="com.minigod.zero.data.entity.TaTHoldingHistoryEntity">
        select a.*
            from t_holding_history a
         left join t_da_client b on b.subAccountId = a.subAccountId and b.daAccountId = 'DF10000001'
        where  a.fundCode = #{productId}
          and b.daClientId  = #{custStatementDTO.subAccountId}
          <if test="custStatementDTO.statementType == 1">
              and a.transactionTime <![CDATA[ <= ]]>  #{custStatementDTO.endDate}
          </if>
          <if test="custStatementDTO.statementType == 2">
              and a.transactionTime <![CDATA[ <= ]]>  #{custStatementDTO.endDate}
          </if>
        order by createTime desc limit 1
    </select>
    <select id="getHldSumInterest" resultType="java.math.BigDecimal">
        SELECT  COALESCE(SUM(a.interest), 0) as interest
        FROM t_daily_interest a
        WHERE a.subAccountId = #{subaccountid}
        AND a.productId = #{productId}
        <if test="custStatementDTO.statementType == 1">
            AND a.interestDate  <![CDATA[ <= ]]> DATE_SUB(#{custStatementDTO.endDate}, INTERVAL 1 DAY)
        </if>
        <if test="custStatementDTO.statementType == 2">
            AND a.interestDate  <![CDATA[ <= ]]> #{custStatementDTO.endDate}
        </if>
    </select>
    <select id="getHldDaySumInterest" resultType="java.math.BigDecimal">
        SELECT  COALESCE(SUM(a.interest), 0) as interest
        FROM t_daily_interest a
        WHERE a.subAccountId = #{subaccountid}
        AND a.productId = #{productId}
        AND a.interestDate  <![CDATA[ <= ]]> #{custStatementDTO.endDate}

    </select>
</mapper>
